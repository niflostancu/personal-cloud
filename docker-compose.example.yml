# Example Compose file using Docker Local Persist volumes.
version: '3'
services:
  frontend:
    image: nicloud/frontend-nginx:latest
    ports:
     - "80:80"
     - "443:443"
    links:
     - ttrss
     - seafile
    environment:
     - SSL_ENABLED=false
     - "DEFAULT_SNIPPETS=seafile ttrss"
    volumes:
     - nginx-config:/etc/nginx.overrides/
     - nginx-letsencrypt:/etc/letsencrypt/
     - seafile:/home/seafile/  # seahub's media needs to be served by nginx
  mysql:
    image: nicloud/mysql:latest
    volumes:
      - mysql:/var/lib/mysql/
  ttrss:
    image: nicloud/ttrss-nginx:latest
    volumes:
     - ttrss:/var/www/
    links:
     - mysql
  seafile:
    image: nicloud/seafile:latest
    volumes:
     - seafile:/home/seafile/
     - seafile-data:/var/lib/seafile/
    links:
     - mysql
    environment:
     - FASTCGI=true

volumes:
  nginx-config:
    driver: local-persist
    driver_opts: { mountpoint: /var/nas-data/nginx-config }
  nginx-letsencrypt:
    driver: local-persist
    driver_opts: { mountpoint: /var/nas-data/letsencrypt }
  ttrss:
    driver: local-persist
    driver_opts: { mountpoint: /var/nas-data/ttrss }
  mysql:
    driver: local-persist
    driver_opts: { mountpoint: /var/nas-data/mysql }
  seafile:
    driver: local-persist
    driver_opts: { mountpoint: /var/nas-data/seafile }
  seafile-data:
    driver: local-persist
    driver_opts: { mountpoint: /var/nas-data/seafile-data }

